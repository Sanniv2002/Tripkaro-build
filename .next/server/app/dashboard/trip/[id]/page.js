(()=>{var e={};e.id=651,e.ids=[651],e.modules={53524:e=>{"use strict";e.exports=require("@prisma/client")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},41790:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},39491:e=>{"use strict";e.exports=require("assert")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},9523:e=>{"use strict";e.exports=require("dns")},82361:e=>{"use strict";e.exports=require("events")},13685:e=>{"use strict";e.exports=require("http")},95687:e=>{"use strict";e.exports=require("https")},41808:e=>{"use strict";e.exports=require("net")},22037:e=>{"use strict";e.exports=require("os")},63477:e=>{"use strict";e.exports=require("querystring")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},24404:e=>{"use strict";e.exports=require("tls")},76224:e=>{"use strict";e.exports=require("tty")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},92168:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>n.a,__next_app__:()=>u,originalPathname:()=>p,pages:()=>x,routeModule:()=>f,tree:()=>c});var a=s(73137),r=s(54647),i=s(4183),n=s.n(i),l=s(71775),d={};for(let e in l)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>l[e]);s.d(t,d);let o=a.AppPageRouteModule,c=["",{children:["dashboard",{children:["trip",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,65709)),"/home/sanniv/expense/app/dashboard/trip/[id]/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,74436)),"/home/sanniv/expense/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,36598)),"/home/sanniv/expense/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,51918,23)),"next/dist/client/components/not-found-error"]}],x=["/home/sanniv/expense/app/dashboard/trip/[id]/page.tsx"],p="/dashboard/trip/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},f=new o({definition:{kind:r.x.APP_PAGE,page:"/dashboard/trip/[id]/page",pathname:"/dashboard/trip/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},94123:(e,t,s)=>{let a={"27789748d4028595e8f7c4f335d85448c4eb53ad":()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.fetchTrips),db7e1d758c705a2e3689b038b7253fafa458c5cd:()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.addTrip),"6875be3eb71c47789351b1ab13a7f89fc0f02960":()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.joinRoom),"519527161853f61403e27d0e4fedaddf7716aac6":()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.getTripDetails),ce63b2e88fe9f05aae1cdf2555fa938e6e894aa6:()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.getTimeline),f6068f201973c2497e9a34d1821ef41ced4dd163:()=>Promise.resolve().then(s.bind(s,97798)).then(e=>e.getTripName),"7c42018fe7813bbebe4e8badec706f3d3efd7d8a":()=>Promise.resolve().then(s.bind(s,94469)).then(e=>e.addExpense),eb0ed05b4c2c3252ca743f9c3e00554e64af611f:()=>Promise.resolve().then(s.bind(s,94469)).then(e=>e.deleteExpense),"195394a3ce70712e614bca841beba68d74f84513":()=>Promise.resolve().then(s.bind(s,23833)).then(e=>e.generateResponseAction),"150caa42f558eba2d4c1d084f97a28bcc01c3cec":()=>Promise.resolve().then(s.bind(s,23833)).then(e=>e.loadChatsAction)};async function r(e,...t){let s=await a[e]();return s.apply(null,t)}e.exports={"27789748d4028595e8f7c4f335d85448c4eb53ad":r.bind(null,"27789748d4028595e8f7c4f335d85448c4eb53ad"),db7e1d758c705a2e3689b038b7253fafa458c5cd:r.bind(null,"db7e1d758c705a2e3689b038b7253fafa458c5cd"),"6875be3eb71c47789351b1ab13a7f89fc0f02960":r.bind(null,"6875be3eb71c47789351b1ab13a7f89fc0f02960"),"519527161853f61403e27d0e4fedaddf7716aac6":r.bind(null,"519527161853f61403e27d0e4fedaddf7716aac6"),ce63b2e88fe9f05aae1cdf2555fa938e6e894aa6:r.bind(null,"ce63b2e88fe9f05aae1cdf2555fa938e6e894aa6"),f6068f201973c2497e9a34d1821ef41ced4dd163:r.bind(null,"f6068f201973c2497e9a34d1821ef41ced4dd163"),"7c42018fe7813bbebe4e8badec706f3d3efd7d8a":r.bind(null,"7c42018fe7813bbebe4e8badec706f3d3efd7d8a"),eb0ed05b4c2c3252ca743f9c3e00554e64af611f:r.bind(null,"eb0ed05b4c2c3252ca743f9c3e00554e64af611f"),"195394a3ce70712e614bca841beba68d74f84513":r.bind(null,"195394a3ce70712e614bca841beba68d74f84513"),"150caa42f558eba2d4c1d084f97a28bcc01c3cec":r.bind(null,"150caa42f558eba2d4c1d084f97a28bcc01c3cec")}},42844:(e,t,s)=>{Promise.resolve().then(s.bind(s,68853))},68853:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>eS});var a=s(60080),r=s(97052),i=s(32293),n=s(39366),l=s(53064),d=s(91672),o=s(23161),c=s(9885),x=s(79428);let p=x.zt,u=x.fC,f=x.xz,m=c.forwardRef(({className:e,sideOffset:t=4,...s},r)=>a.jsx(x.VY,{ref:r,sideOffset:t,className:(0,o.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));m.displayName=x.VY.displayName;var h=s(87502),b=s(51839),j=s(68384),g=s(49424),v=s(33478),y=s(66386),w=s(1264),N=s(56388);function C({tripName:e,roomCode:t}){let[s,r]=(0,c.useState)(!1),{toast:i}=(0,h.pm)(),n=`${window.location.origin}/invite/${t}`,l=async()=>{try{await navigator.clipboard.writeText(n),r(!0),i({title:"Copied to clipboard",description:"The invitation link has been copied to your clipboard."}),setTimeout(()=>r(!1),2e3)}catch(e){i({title:"Failed to copy",description:"Please try copying the link manually.",variant:"destructive"})}};return(0,a.jsxs)(b.Vq,{children:[a.jsx(b.hg,{asChild:!0,children:(0,a.jsxs)(j.z,{variant:"outline",children:[a.jsx(y.Z,{className:"h-4 w-4 mr-2"}),"Invite"]})}),(0,a.jsxs)(b.cZ,{children:[(0,a.jsxs)(b.fK,{children:[(0,a.jsxs)(b.$N,{children:["Invite to ",e]}),a.jsx(b.Be,{children:"Share this link with friends to invite them to join your trip."})]}),(0,a.jsxs)("div",{className:"space-y-4 py-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(v._,{children:"Invitation Link"}),(0,a.jsxs)("div",{className:"flex gap-2",children:[a.jsx(g.I,{readOnly:!0,value:n,onClick:e=>e.currentTarget.select()}),a.jsx(j.z,{variant:"outline",size:"icon",onClick:l,children:s?a.jsx(w.Z,{className:"h-4 w-4 text-green-500"}):a.jsx(N.Z,{className:"h-4 w-4"})})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[a.jsx(v._,{children:"Room Code"}),a.jsx(g.I,{readOnly:!0,value:t,onClick:e=>e.currentTarget.select()})]})]})]})]})}function k({name:e,roomCode:t,totalExpense:s,participantCount:c,expenses:x,participants:b,perPerson:j,userId:g}){let v=x.filter(e=>e.userId===g).reduce((e,t)=>e+t.amount,0),{toast:y}=(0,h.pm)();return(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"col-span-2 flex items-center justify-between gap-2",children:[(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsxs)("h3",{className:"text-4xl font-bold flex gap-2 items-center",children:[a.jsx(n.Z,{}),e]}),(0,a.jsxs)("h1",{className:"text-xs flex gap-1 items-center",children:[t," ",a.jsx("span",{children:a.jsx(l.Z,{onClick:()=>{navigator.clipboard.writeText(t),y({title:"Copied!",description:"Trip Code Copied."})},className:"h-4 cursor-pointer"})})]})]}),a.jsx(C,{tripName:e,roomCode:t})]}),a.jsx(r.Zb,{children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-muted-foreground flex gap-2 items-center",children:["Total Expenses",a.jsx(p,{delayDuration:300,children:(0,a.jsxs)(u,{children:[a.jsx(f,{asChild:!0,children:a.jsx("button",{className:"rounded-full h-4 w-4 inline-flex items-center justify-center border border-muted-foreground/40 text-muted-foreground/70 text-xs hover:bg-muted hover:text-muted-foreground",children:"i"})}),a.jsx(m,{side:"top",className:"text-xs max-w-[200px] p-2",children:a.jsx("p",{children:"The total amount spent by all participants in this trip, including all expenses and shared costs."})})]})})]}),a.jsx("h2",{className:"text-3xl font-bold",children:(0,o.xG)(s)})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-muted-foreground flex gap-2 items-center",children:["Per Person",a.jsx(p,{delayDuration:300,children:(0,a.jsxs)(u,{children:[a.jsx(f,{asChild:!0,children:a.jsx("button",{className:"rounded-full h-4 w-4 inline-flex items-center justify-center border border-muted-foreground/40 text-muted-foreground/70 text-xs hover:bg-muted hover:text-muted-foreground",children:"i"})}),a.jsx(m,{side:"top",className:"text-xs max-w-[200px] p-2",children:a.jsx("p",{children:"The average amount each person should pay for expenses that involve all trip members."})})]})})]}),a.jsx("p",{className:"text-3xl font-semibold",children:(0,o.xG)(j)})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-sm font-medium text-muted-foreground flex gap-2 items-center",children:["Your Spending",a.jsx(p,{delayDuration:300,children:(0,a.jsxs)(u,{children:[a.jsx(f,{asChild:!0,children:a.jsx("button",{className:"rounded-full h-4 w-4 inline-flex items-center justify-center border border-muted-foreground/40 text-muted-foreground/70 text-xs hover:bg-muted hover:text-muted-foreground",children:"i"})}),a.jsx(m,{side:"top",className:"text-xs max-w-[200px] p-2",children:a.jsx("p",{children:"The total amount you have personally spent on this trip, before any settlements or adjustments."})})]})})]}),a.jsx("h2",{className:"text-3xl font-bold",children:(0,o.xG)(v)})]})]})})}),a.jsx(r.Zb,{children:a.jsx(r.aY,{className:"pt-6",children:(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[a.jsx("div",{className:"flex -space-x-2",children:b?.map(e=>a.jsxs(i.qE,{className:"relative border-2 border-background w-8 h-8",children:[a.jsx(p,{delayDuration:300,children:a.jsxs(u,{children:[a.jsx(f,{asChild:!0,children:a.jsx("div",{className:"absolute inset-0 w-full h-full flex items-center justify-center",children:a.jsx("div",{className:"rounded-full w-8 h-8 flex items-center justify-center"})})}),a.jsx(m,{side:"top",className:"text-xs max-w-[200px] p-2",children:a.jsx("p",{children:e.viewName})})]})}),a.jsx(i.F$,{src:e.avatar,alt:e.viewName}),a.jsx(i.Q5,{children:e.viewName})]},e.id))}),(0,a.jsxs)("div",{className:"flex items-center",children:[a.jsx(d.Z,{className:"w-4 h-4 mr-2"}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[c," participants"]})]})]})})})]})}var E=s(36392);let P=E.fC,S=E.xz,q=E.h_,T=c.forwardRef(({className:e,...t},s)=>a.jsx(E.aV,{className:(0,o.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...t,ref:s}));T.displayName=E.aV.displayName;let A=c.forwardRef(({className:e,...t},s)=>(0,a.jsxs)(q,{children:[a.jsx(T,{}),a.jsx(E.VY,{ref:s,className:(0,o.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...t})]}));A.displayName=E.VY.displayName;let _=({className:e,...t})=>a.jsx("div",{className:(0,o.cn)("flex flex-col space-y-2 text-center sm:text-left",e),...t});_.displayName="AlertDialogHeader";let R=({className:e,...t})=>a.jsx("div",{className:(0,o.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...t});R.displayName="AlertDialogFooter";let I=c.forwardRef(({className:e,...t},s)=>a.jsx(E.Dx,{ref:s,className:(0,o.cn)("text-lg font-semibold",e),...t}));I.displayName=E.Dx.displayName;let z=c.forwardRef(({className:e,...t},s)=>a.jsx(E.dk,{ref:s,className:(0,o.cn)("text-sm text-muted-foreground",e),...t}));z.displayName=E.dk.displayName;let $=c.forwardRef(({className:e,...t},s)=>a.jsx(E.aU,{ref:s,className:(0,o.cn)((0,j.d)(),e),...t}));$.displayName=E.aU.displayName;let Z=c.forwardRef(({className:e,...t},s)=>a.jsx(E.$j,{ref:s,className:(0,o.cn)((0,j.d)({variant:"outline"}),"mt-2 sm:mt-0",e),...t}));Z.displayName=E.$j.displayName;var D=s(91721),O=s(19458),G=s(4678);let F=D.fC;D.ZA;let Y=D.B4,V=c.forwardRef(({className:e,children:t,...s},r)=>(0,a.jsxs)(D.xz,{ref:r,className:(0,o.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...s,children:[t,a.jsx(D.JO,{asChild:!0,children:a.jsx(O.Z,{className:"h-4 w-4 opacity-50"})})]}));V.displayName=D.xz.displayName;let L=c.forwardRef(({className:e,...t},s)=>a.jsx(D.u_,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(G.Z,{className:"h-4 w-4"})}));L.displayName=D.u_.displayName;let B=c.forwardRef(({className:e,...t},s)=>a.jsx(D.$G,{ref:s,className:(0,o.cn)("flex cursor-default items-center justify-center py-1",e),...t,children:a.jsx(O.Z,{className:"h-4 w-4"})}));B.displayName=D.$G.displayName;let M=c.forwardRef(({className:e,children:t,position:s="popper",...r},i)=>a.jsx(D.h_,{children:(0,a.jsxs)(D.VY,{ref:i,className:(0,o.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===s&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...r,children:[a.jsx(L,{}),a.jsx(D.l_,{className:(0,o.cn)("p-1","popper"===s&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:t}),a.jsx(B,{})]})}));M.displayName=D.VY.displayName;let U=c.forwardRef(({className:e,...t},s)=>a.jsx(D.__,{ref:s,className:(0,o.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...t}));U.displayName=D.__.displayName;let W=c.forwardRef(({className:e,children:t,...s},r)=>(0,a.jsxs)(D.ck,{ref:r,className:(0,o.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...s,children:[a.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:a.jsx(D.wU,{children:a.jsx(w.Z,{className:"h-4 w-4"})})}),a.jsx(D.eT,{children:t})]}));W.displayName=D.ck.displayName;let Q=c.forwardRef(({className:e,...t},s)=>a.jsx(D.Z0,{ref:s,className:(0,o.cn)("-mx-1 my-1 h-px bg-muted",e),...t}));Q.displayName=D.Z0.displayName;var J=s(80774),K=s(26303);s(70391),s(53009);var H=s(61324),X=(0,H.$)("7c42018fe7813bbebe4e8badec706f3d3efd7d8a"),ee=(0,H.$)("eb0ed05b4c2c3252ca743f9c3e00554e64af611f");function et({user:e,expenses:t,setTrip:s,participants:n,tripId:l,setRefreshTrip:d}){let[x,p]=(0,c.useState)([]),[u,f]=(0,c.useState)(null),[m,y]=(0,c.useState)({title:"",amount:0,category:""}),[w,N]=(0,c.useState)(!1),[C,k]=(0,c.useState)(!1),[E,q]=(0,c.useState)(!1),{toast:T}=(0,h.pm)(),D=async()=>{N(!0);let t={...m,userId:e.id,date:new Date(Date.now()),tripId:l};try{let{expense:e}=await X(t);s(t=>({...t,expenses:[...t.expenses,e]})),T({title:"Expense Added Successfully",description:"Your expense has been successfully added to the trip."})}catch(e){T({title:"Expense Addition Failed",description:"There was an issue while adding the expense. Please try again later."}),console.error("Error adding expense:",e)}finally{N(!1),q(!1),y({title:"",amount:0,category:""}),p([]),d(e=>!e)}};async function O(e){N(!0);try{await ee(e),s(t=>({...t,expenses:t.expenses.filter(t=>t.id!==e)})),T({title:"Expense Deleted Successfully",description:"Your expense has been successfully deleted from the trip."})}catch(e){console.error("Error deleting expense:",e),T({title:"Expense Deletion Failed",description:"You cannot delete an expense created by another participant."})}finally{N(!1),k(!1),d(e=>!e)}}return(0,a.jsxs)(r.Zb,{children:[a.jsx(r.Ol,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsx(r.ll,{children:"Expenses"}),(0,a.jsxs)(b.Vq,{open:E,onOpenChange:q,children:[a.jsx(b.hg,{asChild:!0,children:(0,a.jsxs)(j.z,{className:"w-full sm:w-auto",children:[a.jsx(J.Z,{className:"w-4 h-4 mr-2"}),"Add Expense"]})}),(0,a.jsxs)(b.cZ,{className:"sm:max-w-[425px]",children:[(0,a.jsxs)(b.fK,{children:[a.jsx(b.$N,{children:"Add New Expense"}),a.jsx(b.Be,{children:"Add a new expense and split it among participants."})]}),(0,a.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(v._,{htmlFor:"title",children:"Title"}),a.jsx(g.I,{id:"title",placeholder:"Dinner at Restaurant",value:m.title,onChange:e=>y({...m,title:e.target.value})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(v._,{htmlFor:"amount",children:"Amount"}),a.jsx(g.I,{id:"amount",type:"number",placeholder:"0.00",value:m.amount,onChange:e=>y({...m,amount:parseFloat(e.target.value)})})]}),(0,a.jsxs)("div",{className:"grid gap-2",children:[a.jsx(v._,{htmlFor:"category",children:"Category"}),(0,a.jsxs)(F,{value:m.category,onValueChange:e=>y({...m,category:e}),children:[a.jsx(V,{children:a.jsx(Y,{placeholder:"Select category"})}),(0,a.jsxs)(M,{children:[a.jsx(W,{value:"food",children:"Food"}),a.jsx(W,{value:"transport",children:"Transportation"}),a.jsx(W,{value:"accommodation",children:"Accommodation"}),a.jsx(W,{value:"activities",children:"Activities"}),a.jsx(W,{value:"other",children:"Other"})]})]})]})]}),a.jsx(b.cN,{children:a.jsx(j.z,{type:"submit",onClick:D,children:w?a.jsx("div",{className:"flex justify-center",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,o.cn)("animate-spin"),children:a.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})})}):"Add Expense"})})]})]})]})}),a.jsx(r.aY,{children:t?.length>0?a.jsx("div",{className:"space-y-4",children:t.map(e=>(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between p-4 rounded-lg border gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[a.jsx(i.qE,{children:a.jsx(i.F$,{src:e?.user?.avatar})}),(0,a.jsxs)("div",{children:[a.jsx("p",{className:"font-medium",children:e.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Added by ",e.user?.viewName," â€¢ ",e?.category," â€¢ ",(0,o.p6)(e?.createdAt)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 w-full sm:w-auto justify-between sm:justify-end",children:[a.jsx("p",{className:"font-semibold",children:(0,o.xG)(e.amount)}),(0,a.jsxs)(P,{open:u===e.id,onOpenChange:e=>{e||f(null)},children:[a.jsx(S,{children:a.jsx(K.Z,{className:"h-4 w-4",onClick:()=>f(e.id)})}),(0,a.jsxs)(A,{children:[(0,a.jsxs)(_,{children:[a.jsx(I,{children:"Are you absolutely sure?"}),a.jsx(z,{children:"This action cannot be undone. This will permanently delete this expense."})]}),(0,a.jsxs)(R,{children:[a.jsx(Z,{children:"Cancel"}),a.jsx($,{onClick:()=>u&&O(u),children:w?a.jsx("div",{className:"flex justify-center",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"animate-spin",children:a.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})})}):"Delete"})]})]})]})]})]},e.id))}):a.jsx("p",{children:"No expenses yet."})})]})}var es=s(47087),ea=s(46364),er=s(97389);let ei=(0,er.j)("inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground",{variants:{variant:{default:"bg-transparent",outline:"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground"},size:{default:"h-10 px-3",sm:"h-9 px-2.5",lg:"h-11 px-5"}},defaultVariants:{variant:"default",size:"default"}}),en=c.forwardRef(({className:e,variant:t,size:s,...r},i)=>a.jsx(ea.f,{ref:i,className:(0,o.cn)(ei({variant:t,size:s,className:e})),...r}));en.displayName=ea.f.displayName;let el=c.createContext({size:"default",variant:"default"}),ed=c.forwardRef(({className:e,variant:t,size:s,children:r,...i},n)=>a.jsx(es.fC,{ref:n,className:(0,o.cn)("flex items-center justify-center gap-1",e),...i,children:a.jsx(el.Provider,{value:{variant:t,size:s},children:r})}));ed.displayName=es.fC.displayName;let eo=c.forwardRef(({className:e,children:t,variant:s,size:r,...i},n)=>{let l=c.useContext(el);return a.jsx(es.ck,{ref:n,className:(0,o.cn)(ei({variant:l.variant||s,size:l.size||r}),e),...i,children:t})});eo.displayName=es.ck.displayName;var ec=s(43223),ex=s(69127),ep=s(71072);function eu({expenses:e,view:t,onViewChange:s}){let{theme:i,systemTheme:n}=(0,ep.useTheme)(),[l,d]=(0,c.useState)(!1);if((0,c.useEffect)(()=>{d(!0)},[]),!l)return null;let o="dark"===("system"===i?n:i),x=o?"rgba(255, 255, 255, 0.87)":"rgba(0, 0, 0, 0.87)",p=o?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",u={responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{color:x},grid:{color:p},border:{color:p}},x:{ticks:{color:x},grid:{color:p},border:{color:p}}},plugins:{legend:{labels:{color:x,font:{size:12}}},tooltip:{backgroundColor:o?"rgba(0, 0, 0, 0.8)":"rgba(255, 255, 255, 0.8)",titleColor:o?"#fff":"#000",bodyColor:o?"#fff":"#000",borderColor:p,borderWidth:1}}},f=e.reduce((e,t)=>{let s=new Date(t.date).toLocaleDateString("en-GB",{weekday:"short"});return e[s]||(e[s]=0),e[s]+=t.amount,e},{}),m=Object.keys(f).reverse(),h={labels:m,datasets:[{label:"Daily Expenses",data:m.map(e=>f[e]).reverse(),borderColor:o?"white":"hsl(var(--primary))",backgroundColor:o?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",tension:.4,borderWidth:2}]},b=e.reduce((e,t)=>{let{category:s,amount:a}=t;return e[s]||(e[s]=0),e[s]+=a,e},{}),j=Object.keys(b),g={labels:j,datasets:[{label:"Expenses by Category",data:j.map(e=>b[e]),backgroundColor:["hsl(var(--chart-1))","hsl(var(--chart-2))","hsl(var(--chart-3))","hsl(var(--chart-4))","hsl(var(--chart-5))"],borderWidth:1,borderColor:o?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)"}]};return a.jsx(a.Fragment,{children:(0,a.jsxs)(r.Zb,{children:[a.jsx(r.Ol,{children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[a.jsx(r.ll,{children:"Expense Analysis"}),(0,a.jsxs)(ed,{type:"single",value:t,onValueChange:e=>s(e),className:"flex-shrink-0",children:[a.jsx(eo,{value:"daily",className:"text-xs sm:text-sm",children:"Daily"}),a.jsx(eo,{value:"category",className:"text-xs sm:text-sm",children:"Category"})]})]})}),a.jsx(r.aY,{children:a.jsx("div",{className:"h-[300px] sm:h-[400px]",children:"daily"===t?a.jsx(ec.x1,{data:h,options:u}):a.jsx(ec.$Q,{data:g,options:u})})})]})})}ex.kL.register(ex.uw,ex.f$,ex.od,ex.jn,ex.ZL,ex.Dx,ex.u,ex.De);var ef=s(2129),em=s(26415);function eh({settlements:e}){let t=e.map(e=>({from:{name:e.from,image:e.fromAvatar},to:{name:e.to,image:e.toAvatar},amount:e.amount}));return a.jsx(r.Zb,{className:"col-span-2",children:(0,a.jsxs)(r.aY,{className:"pt-6",children:[a.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Outstanding Payments"}),a.jsx("div",{className:"space-y-4",children:t.map((e,t)=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsxs)(ef.qE,{className:"h-8 w-8",children:[a.jsx(ef.F$,{src:e.from.image,alt:e.from.name}),a.jsx(ef.Q5,{children:e.from.name[0]})]}),a.jsx(em.Z,{className:"mx-6"}),(0,a.jsxs)(ef.qE,{className:"h-8 w-8",children:[a.jsx(ef.F$,{src:e.to.image,alt:e.to.name}),a.jsx(ef.Q5,{children:e.to.name[0]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsxs)("span",{className:"text-sm font-medium",children:[e.from.name," owes ",e.to.name]}),a.jsx("span",{className:"font-bold",children:(0,o.xG)(e.amount)})]})]},t))})]})})}var eb=s(57114),ej=s(28516),eg=s(74284),ev=s(41779);let ey=c.forwardRef(({className:e,children:t,...s},r)=>(0,a.jsxs)(ev.fC,{ref:r,className:(0,o.cn)("relative overflow-hidden",e),...s,children:[a.jsx(ev.l_,{className:"h-full w-full rounded-[inherit]",children:t}),a.jsx(ew,{}),a.jsx(ev.Ns,{})]}));ey.displayName=ev.fC.displayName;let ew=c.forwardRef(({className:e,orientation:t="vertical",...s},r)=>a.jsx(ev.gb,{ref:r,orientation:t,className:(0,o.cn)("flex touch-none select-none transition-colors","vertical"===t&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===t&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...s,children:a.jsx(ev.q4,{className:"relative flex-1 rounded-full bg-border"})}));ew.displayName=ev.gb.displayName;var eN=s(90853);function eC({events:e}){let t=(0,c.useRef)(null);return(0,c.useEffect)(()=>{t.current&&t.current.scrollTo({top:0,behavior:"smooth"})},[e]),(0,a.jsxs)(r.Zb,{children:[a.jsx(r.Ol,{children:a.jsx(r.ll,{children:"Trip Timeline"})}),a.jsx(r.aY,{children:a.jsx(ey,{className:" max-h-80 overflow-y-auto rounded-md border",ref:t,children:a.jsx("div",{className:"space-y-8 p-4",children:[...e].reverse().map(e=>(0,a.jsxs)("div",{className:"flex gap-4 relative",children:[a.jsx("div",{className:"w-10 h-10 rounded-full flex-shrink-0",children:(0,a.jsxs)(i.qE,{children:[a.jsx(i.F$,{src:e.message.avatar}),a.jsx(i.Q5,{children:e.message.content})]})}),(0,a.jsxs)("div",{className:"flex-1 space-y-1",children:[a.jsx("p",{className:"text-sm font-medium",children:e.message.content}),a.jsx("p",{className:"text-xs text-muted-foreground",children:(0,eN.Z)(e.createdAt,{addSuffix:!0})})]})]},e.id))})})})]})}var ek=s(39965),eE=s(79684),eP=s(56206);function eS(){let[e,t]=(0,c.useState)("daily"),[s,r]=(0,c.useState)(),[i,n]=(0,c.useState)(!0),[l,d]=(0,c.useState)(!1),[x,p]=(0,c.useState)(),u=(0,eb.usePathname)(),f=u.split("/").pop(),m=(0,eb.useRouter)(),h=(0,eg.useSession)();return("unauthenticated"===h.status&&m.push("/"),(0,c.useEffect)(()=>{(async function(){if(f)try{let e=await (0,ej.Ig)(f),t=await (0,ej.VS)(f);e&&(r(e),p(t))}catch(e){m.push("/invalid"),console.error("Failed to fetch trip details:",e)}finally{n(!1)}})()},[f,l]),(0,c.useEffect)(()=>{if(f){let e=`wss://events-tripkaro-production.up.railway.app?tripId=${f}`,t=new WebSocket(e);return t.onopen=()=>{},t.onmessage=e=>{d(e=>!e)},t.onclose=()=>{},t.onerror=e=>{console.error("WebSocket error:",e)},()=>{t.close()}}},[f]),i)?a.jsx("div",{className:"flex justify-center items-center h-screen",children:a.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:(0,o.cn)("animate-spin"),children:a.jsx("path",{d:"M21 12a9 9 0 1 1-6.219-8.56"})})}):(0,a.jsxs)("div",{className:"space-y-8",children:[a.jsx(k,{name:s?.trip.name,roomCode:s?.trip.roomCode,totalExpense:s?.totalExpense,participantCount:s?.participants.length,userId:s?.userId,expenses:s?.expenses,participants:s?.participants,perPerson:s?.perPerson}),a.jsx(et,{user:h.data?.user,expenses:s?.expenses,setTrip:r,participants:s?.participants,tripId:f,setRefreshTrip:d}),a.jsx(eu,{expenses:s?.expenses,view:e,onViewChange:t}),a.jsx(eh,{settlements:s?.settlements}),a.jsx(eC,{events:x}),null]})}(0,H.$)("195394a3ce70712e614bca841beba68d74f84513"),(0,H.$)("150caa42f558eba2d4c1d084f97a28bcc01c3cec"),s(13560),s(5705)},23833:(e,t,s)=>{"use strict";s.r(t),s.d(t,{generateResponseAction:()=>o,loadChatsAction:()=>x});var a=s(57016),r=s(50138),i=s(69568),n=s(9901),l=s(5224),d=s(77728);async function o(e,t){let s=await (0,n.getServerSession)(i.authOptions);if(!s?.user?.id)throw Error("User not authenticated");let a=await c(e,t);return await (0,l.addToBuffer)(s?.user?.id,e,t,a),{message:a}}async function c(e,t){let s=await r.default.generateContent(t);return s.response.text()}async function x(e,t=20){let s=await (0,n.getServerSession)(i.authOptions);if(!s?.user?.id)throw Error("User not authenticated");let a=s.user.id,r=await d.default.chatLog.findMany({where:{userId:a},orderBy:{timestamp:"desc"},take:t,...e&&{skip:1,cursor:{id:e}}});return r.map(e=>({id:e.id,role:e.botReply?"assistant":"user",prompt:e.prompt,content:e.botReply,timestamp:e.timestamp}))}(0,s(96276).ensureServerEntryExports)([o,x]),(0,a.createActionProxy)("195394a3ce70712e614bca841beba68d74f84513",null,o),(0,a.createActionProxy)("150caa42f558eba2d4c1d084f97a28bcc01c3cec",null,x)},94469:(e,t,s)=>{"use strict";s.r(t),s.d(t,{addExpense:()=>c,deleteExpense:()=>x});var a=s(57016),r=s(77728),i=s(9901),n=s(69568),l=s(88490),d=s(96276);let o=()=>"true"===process.env.ENABLE_CACHE;async function c(e){let{tripId:t,title:s,date:a,amount:d,userId:c,category:x,notes:p}=e;if(!s&&!d)throw Error("Got missing arguments");let u=await (0,i.getServerSession)(n.authOptions);if(!u?.user?.id)throw Error("User not authenticated");try{let e=await r.default.trip.findUnique({where:{id:t},include:{participants:!0}});if(!e)throw Error("Trip not found");let i=e.participants.some(e=>e.id===c);if(!i)throw Error(`User with ID ${c} is not a participant in the trip`);let n=await r.default.expense.create({data:{title:s,amount:d,date:a,category:x,notes:p,tripId:t,userId:c},include:{user:!0}});await r.default.trip.update({where:{id:t},data:{expenses:{connect:{id:n.id}}}});let f={content:`${u.user.viewName} added an expense of â‚¹${d}. Time to keep track! ðŸ§¾`,avatar:u.user.avatar,userId:u.user.id};return await r.default.timeline.create({data:{message:f,trip:{connect:{id:t}}}}),fetch("https://events-tripkaro-production.up.railway.app/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tripId:t,message:f})}),o()&&await l.default.del(`trip:${t}:details`),{success:!0,expense:n}}catch(e){throw console.error("Error adding expense:",e),Error("Unable to add expense")}}async function x(e){let t=await (0,i.getServerSession)(n.authOptions);if(!t?.user?.id)throw Error("User not authenticated");try{let s=await r.default.expense.findUnique({where:{id:e},include:{trip:!0}});if(!s)throw Error("Expense not found");if(console.log(t.user.id,s.userId),s.userId!==t.user.id)throw Error("You are not authorized to delete this expense");await r.default.expense.delete({where:{id:e}});let a={content:`${t.user.viewName} removed an expense. Budget updated! âœ‚ï¸`,avatar:t.user.avatar,userId:t.user.id};await r.default.timeline.create({data:{message:a,trip:{connect:{id:s.trip.id}}}});let i={tripId:s.trip.id,message:a};return fetch("https://events-tripkaro-production.up.railway.app/send-notification",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),o()&&s.tripId&&await l.default.del(`trip:${s.tripId}:details`),{success:!0,message:"Expense deleted successfully"}}catch(e){throw console.error("Error deleting expense:",e),Error("Unable to delete expense")}}(0,d.ensureServerEntryExports)([c,x]),(0,a.createActionProxy)("7c42018fe7813bbebe4e8badec706f3d3efd7d8a",null,c),(0,a.createActionProxy)("eb0ed05b4c2c3252ca743f9c3e00554e64af611f",null,x)},65709:(e,t,s)=>{"use strict";s.r(t),s.d(t,{$$typeof:()=>n,__esModule:()=>i,default:()=>d});var a=s(17536);let r=(0,a.createProxy)(String.raw`/home/sanniv/expense/app/dashboard/trip/[id]/page.tsx`),{__esModule:i,$$typeof:n}=r,l=r.default,d=l},50138:(e,t,s)=>{"use strict";s.d(t,{default:()=>l});var a=s(76180);let r=process.env.GEMINI_API_KEY||"",i=new a.GoogleGenerativeAI(r),n=i.getGenerativeModel({model:"gemini-1.5-flash"}),l=n},5224:(e,t,s)=>{"use strict";s.d(t,{addToBuffer:()=>i});var a=s(77728);let r=[];async function i(e,t,s,a){r.push({userId:e,context:t,prompt:s,botReply:a,timestamp:new Date}),r.length>=100&&await n()}async function n(){if(r.length>0){let e=[...r];r.length=0;try{await a.default.chatLog.createMany({data:e}),console.log("Flushed chat buffer to the database.")}catch(e){console.error("Failed to flush chat buffer:",e)}}}setInterval(async()=>{await n()},5e3),setInterval(async()=>{await n()},5e3),process.on("SIGTERM",async()=>{await n(),process.exit(0)}),process.on("SIGINT",async()=>{await n(),process.exit(0)})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[650,690,262,955,396,746,684,384,838,789,52],()=>s(92168));module.exports=a})();